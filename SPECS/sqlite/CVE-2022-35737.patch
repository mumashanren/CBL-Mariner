From adceec3cbe8474b5c70a98d5ac8ea2d0c399084c Mon Sep 17 00:00:00 2001
From: Olivia Crain <olivia@olivia.dev>
Date: Tue, 1 Nov 2022 18:58:30 +0000
Subject: [PATCH] Increase the size of loop variables in the printf()
 implementation to avoid integer overflow on multi-gigabyte string arguments.

Fixes CVE-2022-35737. Ported from upstream fossil repository to library
amalgamation release version 3340100.

Provenance: https://www.sqlite.org/src/info/26db4fc22fe66658

Signed-off-by: Olivia Crain <oliviacrain@microsoft.com>
---
 sqlite3.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/sqlite3.c b/sqlite3.c
index 38874ce..9cf3400 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -29022,8 +29022,8 @@ SQLITE_API void sqlite3_str_vappendf(
       case etSQLESCAPE:           /* %q: Escape ' characters */
       case etSQLESCAPE2:          /* %Q: Escape ' and enclose in '...' */
       case etSQLESCAPE3: {        /* %w: Escape " characters */
-        int i, j, k, n, isnull;
-        int needQuote;
+        i64 i, j, k, n;
+        int needQuote, isnull;
         char ch;
         char q = ((xtype==etSQLESCAPE3)?'"':'\'');   /* Quote character */
         char *escarg;
-- 
2.34.1


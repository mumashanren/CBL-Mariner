diff --new-file -ur rsyslog-8.37.0/tests/imptcp-octet-framing-too-long-vg.sh rsyslog-8.37.0Fixed/tests/imptcp-octet-framing-too-long-vg.sh
--- rsyslog-8.37.0/tests/imptcp-octet-framing-too-long-vg.sh	1969-12-31 16:00:00.000000000 -0800
+++ rsyslog-8.37.0Fixed/tests/imptcp-octet-framing-too-long-vg.sh	2022-05-23 16:39:02.944887345 -0700
@@ -0,0 +1,22 @@
+#!/bin/bash
+# added 2022-04-25 by RGerhards, released under ASL 2.0
+. ${srcdir:=.}/diag.sh init
+generate_conf
+add_conf '
+$MaxMessageSize 128
+global(processInternalMessages="on"
+	oversizemsg.input.mode="accept")
+module(load="../plugins/imptcp/.libs/imptcp")
+input(type="imptcp" port="0" listenPortFileName="'$RSYSLOG_DYNNAME'.tcpflood_port")
+action(type="omfile" file="'$RSYSLOG_OUT_LOG'")
+'
+startup_vg
+echo "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000 <120> 2011-03-01T11:22:12Z host tag: this is a way too long message that has to be truncatedtest1 test2 test3 test4 test5 ab" > $RSYSLOG_DYNNAME.inputfile
+tcpflood -I $RSYSLOG_DYNNAME.inputfile
+shutdown_when_empty
+wait_shutdown_vg
+check_exit_vg
+
+# the prime objective is to see if valgrind check is ok, but we also do a quick content check (just in case)
+content_check "received oversize message from peer"
+exit_test
\ No newline at end of file
diff --new-file -ur rsyslog-8.37.0/tests/imtcp-octet-framing-too-long-vg.sh rsyslog-8.37.0Fixed/tests/imtcp-octet-framing-too-long-vg.sh
--- rsyslog-8.37.0/tests/imtcp-octet-framing-too-long-vg.sh	1969-12-31 16:00:00.000000000 -0800
+++ rsyslog-8.37.0Fixed/tests/imtcp-octet-framing-too-long-vg.sh	2022-05-23 16:39:03.540885657 -0700
@@ -0,0 +1,22 @@
+#!/bin/bash
+# added 2022-04-25 by RGerhards, released under ASL 2.0
+. ${srcdir:=.}/diag.sh init
+generate_conf
+add_conf '
+$MaxMessageSize 128
+global(processInternalMessages="on"
+	oversizemsg.input.mode="accept")
+module(load="../plugins/imtcp/.libs/imtcp")
+input(type="imtcp" port="0" listenPortFileName="'$RSYSLOG_DYNNAME'.tcpflood_port")
+action(type="omfile" file="'$RSYSLOG_OUT_LOG'")
+'
+startup_vg
+echo "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000 <120> 2011-03-01T11:22:12Z host tag: this is a way too long message that has to be truncatedtest1 test2 test3 test4 test5 ab" > $RSYSLOG_DYNNAME.inputfile
+tcpflood -I $RSYSLOG_DYNNAME.inputfile
+shutdown_when_empty
+wait_shutdown_vg
+check_exit_vg
+
+# the prime objective is to see if valgrind check is ok, but we also do a quick content check (just in case)
+content_check "received oversize message from peer"
+exit_test
\ No newline at end of file
diff --new-file -ur rsyslog-8.37.0/tests/Makefile.am rsyslog-8.37.0Fixed/tests/Makefile.am
--- rsyslog-8.37.0/tests/Makefile.am	2022-05-23 16:37:53.781082210 -0700
+++ rsyslog-8.37.0Fixed/tests/Makefile.am	2022-05-23 16:39:05.404880383 -0700
@@ -107,6 +107,7 @@
 	validation-run.sh \
 	msgdup.sh \
 	empty-ruleset.sh \
+	imtcp-octet-framing-too-long-vg.sh \
 	imtcp-discard-truncated-msg.sh \
 	imtcp-basic.sh \
 	imtcp-maxFrameSize.sh \
@@ -536,6 +537,7 @@
 # need to be disabled if we do not have this module
 TESTS +=  \
 	manyptcp.sh \
+	imptcp-octet-framing-too-long-vg.sh \
 	imptcp_framing_regex.sh \
 	imptcp_framing_regex-oversize.sh \
 	imptcp_large.sh \
@@ -1243,6 +1245,7 @@
 	mmjsonparse_simple.sh \
 	mmjsonparse-invalid-containerName.sh \
 	wtpShutdownAll-assertionFailure.sh \
+	imptcp-octet-framing-too-long-vg.sh \
 	imptcp-oversize-message-display.sh \
 	imptcp-msg-truncation-on-number.sh \
 	imptcp-msg-truncation-on-number2.sh \
@@ -1294,6 +1297,7 @@
 	msgdup.sh \
 	empty-ruleset.sh \
 	testsuites/empty-ruleset.conf \
+	imtcp-octet-framing-too-long-vg.sh \
 	imtcp-discard-truncated-msg.sh \
 	imtcp-basic.sh \
 	imtcp-maxFrameSize.sh \

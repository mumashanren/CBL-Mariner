diff -ru krb5-1.18.4/src/lib/krb5/krb/pac.c krb5-1.18.4-mod/src/lib/krb5/krb/pac.c
--- krb5-1.18.4/src/lib/krb5/krb/pac.c	2021-07-22 16:53:29.000000000 -0700
+++ krb5-1.18.4-mod/src/lib/krb5/krb/pac.c	2023-01-06 13:09:36.651539304 -0800
@@ -27,6 +27,8 @@
 #include "k5-int.h"
 #include "authdata.h"
 
+#define MAX_BUFFERS 4096
+
 /* draft-brezak-win2k-krb-authz-00 */
 
 /*
@@ -316,6 +318,9 @@
     if (version != 0)
         return EINVAL;
 
+    if (cbuffers < 1 || cbuffers > MAX_BUFFERS)
+        return ERANGE;
+
     header_len = PACTYPE_LENGTH + (cbuffers * PAC_INFO_BUFFER_LENGTH);
     if (len < header_len)
         return ERANGE;
@@ -348,8 +353,8 @@
             krb5_pac_free(context, pac);
             return EINVAL;
         }
-        if (buffer->Offset < header_len ||
-            buffer->Offset + buffer->cbBufferSize > len) {
+        if (buffer->Offset < header_len || buffer->Offset > len ||
+            buffer->cbBufferSize > len - buffer->Offset) {
             krb5_pac_free(context, pac);
             return ERANGE;
         }
diff -ru krb5-1.18.4/src/lib/krb5/krb/t_pac.c krb5-1.18.4-mod/src/lib/krb5/krb/t_pac.c
--- krb5-1.18.4/src/lib/krb5/krb/t_pac.c	2021-07-22 16:53:29.000000000 -0700
+++ krb5-1.18.4-mod/src/lib/krb5/krb/t_pac.c	2023-01-06 13:13:47.269305565 -0800
@@ -431,6 +431,16 @@
     0x8a, 0x81, 0x9c, 0x9c, 0x00, 0x00, 0x00, 0x00
 };
 
+static const unsigned char fuzz1[] = {
+    0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
+    0x06, 0xff, 0xff, 0xff, 0x00, 0x00, 0xf5
+};
+
+static const unsigned char fuzz2[] = {
+    0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00,
+    0x20, 0x20
+};
+
 static const char *s4u_principal = "w2k8u@ACME.COM";
 static const char *s4u_enterprise = "w2k8u@abc@ACME.COM";
 
@@ -645,6 +655,14 @@
         krb5_free_principal(context, sp);
         krb5_free_principal(context, sep);
     }
+    
+    /* Check problematic PACs found by fuzzing. */
+    ret = krb5_pac_parse(context, fuzz1, sizeof(fuzz1), &pac);
+    if (!ret)
+        err(context, ret, "krb5_pac_parse should have failed");
+    ret = krb5_pac_parse(context, fuzz2, sizeof(fuzz2), &pac);
+    if (!ret)
+        err(context, ret, "krb5_pac_parse should have failed");
 
     /*
      * Test empty free

Modified patch 44a700d2051a666235748970c2df047ff207aeb5 to apply to CBL-Mariner
Modified-By: Aur√©lien Bombo <abombo@microsoft.com>
From 26ff82c219ffae5aacd9348d3950345aa11573ec Mon Sep 17 00:00:00 2001
From: Simon Josefsson <simon@josefsson.org>
Date: Wed, 17 Aug 2022 12:25:06 +0200
Subject: [PATCH] Fix ETYPE_OK off by one array size check. Closes: #32.

Reported by David Trabish in
<https://gitlab.com/gnutls/libtasn1/-/issues/32>.

Signed-off-by: Simon Josefsson <simon@josefsson.org>
---
 NEWS      | 3 +++
 lib/int.h | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/NEWS b/NEWS
index 55ae59d..5814a2e 100644
--- a/NEWS
+++ b/NEWS
@@ -1,5 +1,8 @@
 GNU Libtasn1 NEWS                                     -*- outline -*-
 
+* Noteworthy changes in release ?.? (????-??-??) [?]
+- Fix ETYPE_OK out of bounds read.  Closes: #32.
+
 * Noteworthy changes in release 4.14 (released 2019-07-21) [stable]
 - New #defines for version checking: ASN1_VERSION_MAJOR, ASN1_VERSION_MINOR,
   ASN1_VERSION_PATCH, ASN1_VERSION_NUMBER. The next release will switch
diff --git a/lib/int.h b/lib/int.h
index 7d2eea3..18024ea 100644
--- a/lib/int.h
+++ b/lib/int.h
@@ -98,7 +98,7 @@ typedef struct tag_and_class_st
 #define ETYPE_TAG(etype) (_asn1_tags[etype].tag)
 #define ETYPE_CLASS(etype) (_asn1_tags[etype].class)
 #define ETYPE_OK(etype) (((etype) != ASN1_ETYPE_INVALID && \
-                          (etype) <= _asn1_tags_size && \
+                          (etype) < _asn1_tags_size && \
                           _asn1_tags[(etype)].desc != NULL)?1:0)
 
 #define ETYPE_IS_STRING(etype) ((etype == ASN1_ETYPE_GENERALSTRING || \
-- 
2.17.1

